<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">

    <!-- Title Page-->
    <title>List of findings</title>

    <!-- Fontfaces CSS-->
    <link href="css/font-face.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
    <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="vendor/animsition/animsition.min.css" rel="stylesheet" media="all">
    <link href="vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" media="all">
    <link href="vendor/wow/animate.css" rel="stylesheet" media="all">
    <link href="vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
    <link href="vendor/slick/slick.css" rel="stylesheet" media="all">
    <link href="vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="css/theme.css" rel="stylesheet" media="all">
<style>
      .mapadetalle
    {
           height: 500px;
         width: 100%;
    }
    </style>
</head>

<body class="animsition" onload="cargar()">
    <div class="page-wrapper">
       <!-- HEADER MOBILE-->
          <header class="header-mobile d-block d-lg-none">
            <div class="header-mobile__bar">
                <div class="container-fluid">
                    <div class="header-mobile-inner">
                        <a class="logo" href="index.html">
                           PEGASUS
                        </a>
                        <button class="hamburger hamburger--slider" type="button">
                            <span class="hamburger-box">
                                <span class="hamburger-inner"></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
            <nav class="navbar-mobile">
                <div class="container-fluid">
                    <ul class="navbar-mobile__list list-unstyled">
                    <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-user"></i></i>User</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="Usuario.html">New User</a>
                                </li>
                                <li>
                                    <a href="Listausuarios.html">List of users</a>
                                </li>
                              
                            </ul>
                        </li>
                        
                        
                           
                       <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-angle-right"></i>Category</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="Categoria.html">New category</a>
                                </li>
                                <li>
                                    <a href="Listacategorias.html">List of category</a>
                                </li>
                              
                            </ul>
                        </li>
                      <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="far fa-hand-point-right"></i>Findings</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="Hallazgo.html">New finding</a>
                                </li>
                                <li>
                                    <a href="Listahallazgos.html">List of findings</a>
                                </li>
                              
                            </ul>
                        </li>
                 <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="far fa-hand-point-right"></i>Protected areas</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="nuevazona.html">New protected area</a>
                                </li>
                                <li>
                                    <a href="Listazonas.html">List of protected areas</a>
                                </li>
                              
                            </ul>
                        </li>
                        <li>
                            <a href="configuracion.html">
                               <i class="fas fa-cogs"></i>Configuration</a>
                        </li>
                         <li>
                            <a href="chart.html">
                                <i class="fas fa-chart-pie"></i>Figures</a>
                        </li>
                        <li>
                            <a href="map.html">
                                <i class="fas fa-map-marker-alt"></i>Public map</a>
                        </li>
                  <li>
                            <a href="Log.html">
                                      <i class="far fa-file-alt"></i>Log</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
       <!-- END HEADER MOBILE-->

       <!-- MENU SIDEBAR-->
       <aside class="menu-sidebar d-none d-lg-block">
            <div class="logo">
                PEGASUS
            </div>
            <div class="menu-sidebar__content js-scrollbar1">
                <nav class="navbar-sidebar">
                    <ul class="list-unstyled navbar__list">
                       
                      
                    <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-user"></i></i>User</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="Usuario.html">New User</a>
                                </li>
                                <li>
                                    <a href="Listausuarios.html">List of users</a>
                                </li>
                              
                            </ul>
                        </li>
                        
                        
                           
                       <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-angle-right"></i>Category</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="Categoria.html">New category</a>
                                </li>
                                <li>
                                    <a href="Listacategorias.html">List of category</a>
                                </li>
                              
                            </ul>
                        </li>
                       <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="far fa-hand-point-right"></i>Findings</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="Hallazgo.html">New finding</a>
                                </li>
                                <li>
                                    <a href="Listahallazgos.html">List of findings</a>
                                </li>
                              
                            </ul>
                        </li>
                 <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="far fa-hand-point-right"></i>Protected areas</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="nuevazona.html">New protected area</a>
                                </li>
                                <li>
                                    <a href="Listazonas.html">List of protected areas</a>
                                </li>
                              
                            </ul>
                        </li>
                        <li>
                            <a href="configuracion.html">
                               <i class="fas fa-cogs"></i>Configuration</a>
                        </li>
                         <li>
                            <a href="chart.html">
                                <i class="fas fa-chart-pie"></i>Figures</a>
                        </li>
                        <li>
                            <a href="map.html">
                                <i class="fas fa-map-marker-alt"></i>Public map</a>
                        </li>
                  <li>
                            <a href="Log.html">
                                <i class="far fa-file-alt"></i>Log</a>
                        </li>
                     </ul>
                </nav>
            </div>
        </aside>
         <!-- END MENU SIDEBAR-->

        <!-- PAGE CONTAINER-->
        <div class="page-container">
            <!-- HEADER DESKTOP-->
            <header class="header-desktop">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <div class="header-wrap">
                           
                            <div class="header-button">
                             
                                <div class="account-wrap">
                                    <div class="account-item clearfix js-item-menu">
                                        <div class="image">
                                            <img src="" alt="" id="imgperfil" />
                                        </div>
                                        <div class="content">
                                            <a class="js-acc-btn" id="nombredeusuario" ></a>
                                        </div>
                                        <div class="account-dropdown js-dropdown">
                                            <div class="info clearfix">
                                                <div class="image">
                                                    <a href="#">
                                                        <img src="" alt="" id="imgperfil2"/>
                                                    </a>
                                                </div>
                                                <div class="content">
                                                    <h5 class="name">
                                                        <a href="#"></a>
                                                    </h5>
                                                    <span class="email" id="emailuser"></span>
                                                </div>
                                            </div>
                                            <div class="account-dropdown__body">
                                               
                                                <div class="account-dropdown__item">
                                                    <a href="configuracion.html">
                                                        <i class="zmdi zmdi-settings"></i>Configuration</a>
                                                </div>
                                              
                                            </div>
                                            <div class="account-dropdown__footer">
                                                <a href="#" onclick="salirdelsistema()">
                                                    <i class="zmdi zmdi-power"></i>Log Out</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <!-- END HEADER DESKTOP-->

            <!-- MAIN CONTENT-->
            <div class="main-content">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <div class="row m-t-30" id="cuadrotabla">
                            <div class="col-md-12">
                                <!-- DATA TABLE-->
                                <div class="table-responsive m-b-40">
                                  
                                    
                                    <table class="table table-borderless table-data3" id="tabla">
                                        <thead>
                                            <tr>
                                                    <th>Name of conflict</th>
                                               
                                                <th>Country</th>
                                               
                                              
                                                   <th>State or Province</th>
                                                  <th>Actual state</th>
                                                 <th>Update</th>
                                                <th>Delete</th>
                                                 <th>See photo(s)</th>
                                                <th>See map</th>
                                            </tr>
                                        </thead>
                                        <tbody id ="agregaraquifilas">
                                           <!--  <tr>
                                                <td>2018-09-29 05:57</td>
                                                <td>Mobile</td>
                                                <td>iPhone X 64Gb Grey</td>
                                                <td class="process">Processed</td>
                                                <td>$999.00</td>
                                            </tr>-->
                                        
                                        </tbody>
                                    </table>
                                </div>
                                <!-- END DATA TABLE-->
                            </div>
                        </div>
                   
                    </div>
                </div>
            </div>
        </div>
	<div class="modal fade" id="largeModalphoto" tabindex="-1" role="dialog" aria-labelledby="largeModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-lg" role="document">
					<div class="modal-content" id="fototeca" style="padding:10px;text-align:center;">
                        <h2 id="nombrehallazgoimgs"></h2>
                        <hr>
					<table style="position: relative;left: 50px;"><tbody ><tr id="fila0"></tr><tr id="fila1"></tr><tr id="fila2"></tr><tr id="fila3"></tr></tbody></table>
                        <hr>
                         <div class="row form-group" style="padding: 30px;">
                                                <div class="col col-md-3">
                                                    <label for="file-input" class=" form-control-label">To add a picture</label>
                                                </div>
                                                <div class="col-12 col-md-9">
                                                    <input type="file" id="file" name="file-input" class="form-control-file">
                                                </div>
                                         
                                         
                                         <table style="position: relative;left: 50px;"><tbody ><tr id="fila0n"></tr><tr id="fila1n"></tr><tr id="fila2n"></tr><tr id="fila3n"></tr></tbody></table>
                                         
                                            </div>
                        <img width="500px" height="500px" src="" id="imagengrande">
					</div>
				</div>
			</div>
        
        
         <div class="modal fade" id="largeModalmapa" tabindex="-1" role="dialog" aria-labelledby="scrollmodalLabel" aria-hidden="true">
				<div class="modal-dialog modal-lg" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h3 class="modal-title"  id="titulodetalle"></h3>
						  <div id="mapdetalle"  class="mapadetalle"></div>
                            <hr>
						</div>
					
						
					</div>
				</div>
			</div>
    </div>

    <!-- Jquery JS-->
    <script src="vendor/jquery-3.2.1.min.js"></script>
    <!-- Bootstrap JS-->
    <script src="vendor/bootstrap-4.1/popper.min.js"></script>
    <script src="vendor/bootstrap-4.1/bootstrap.min.js"></script>
    <!-- Vendor JS       -->
    <script src="vendor/slick/slick.min.js">
    </script>
    <script src="vendor/wow/wow.min.js"></script>
    <script src="vendor/animsition/animsition.min.js"></script>
    <script src="vendor/bootstrap-progressbar/bootstrap-progressbar.min.js">
    </script>
    <script src="vendor/counter-up/jquery.waypoints.min.js"></script>
    <script src="vendor/counter-up/jquery.counterup.min.js">
    </script>
    <script src="vendor/circle-progress/circle-progress.min.js"></script>
    <script src="vendor/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="vendor/chartjs/Chart.bundle.min.js"></script>
    <script src="vendor/select2/select2.min.js">
    </script>

    <!-- Main JS-->
    <script src="js/main.js"></script>
          <script src="js/blockUI.js"></script>
<script type="text/javascript">
    
    

    
      if (JSON.parse(localStorage.getItem("usuariologueado")) == null) {
            alert("You are not authorized to enter yet");
            location.href = "/login.html";

        }
    else
        {
            if  (JSON.parse(localStorage.getItem("usuariologueado"))[0].tipousuario =="Visitor")
              {
                  alert("You do not have permission to enter this option");
                  window.history.back();
              }
            document.getElementById("nombredeusuario").innerHTML = JSON.parse(localStorage.getItem("usuariologueado"))[0].nombre + " "+ JSON.parse(localStorage.getItem("usuariologueado"))[0].apellido;
             document.getElementById("imgperfil").src=JSON.parse(localStorage.getItem("usuariologueado"))[0].foto;
                     document.getElementById("imgperfil2").src=JSON.parse(localStorage.getItem("usuariologueado"))[0].foto;
        }
    
    var hallazgoseleccionado="";
      var vectordeimegenesenbase64 = [];
      $("#file").change(function(){
       readURL(this);
 });
    
        function readURL(input) {

                    if (input.files && input.files[0]) {
                        var reader = new FileReader();

                        reader.onload = function (e) {

                            var objeto = new Object();
                           
                            objeto.imgData = e.target.result;

                           // vectordeimegenesenbase64.push(objeto);

                            //imagesdesdevector();
                          
                            var r = confirm("You want to add the photo to the find?");
if (r == true) {
                    
                
                      $('#fototeca').block({
                            message: '<h4>Charging...</h4><img src="/imgs/carga.gif" style="width:25%;height:25%;"/>',


                        });
        
                        
                         var tamanno = objeto.imgData.length;//RECUPERO EL TAMANNO TOTAL DEL TEXTO BASE 64 DE LA IMAGEN SUBIDA
                            var mitad = Math.round(tamanno / 2);//SACO LA MITAD DEL TAMANNO TOTAL, REDONDEANDOLO PARA QUE ME DE UN NUMERO ENTERO

                          var  imagenentextoparte1Perfil = objeto.imgData.substring(0, mitad);//EN LA PRIMERA PARTE DE LA IMAGEN EN TEXTO, EN LA VARIABLE GLOBAL, ALMACENO EL TEXTO HASTA LA MITAD
                         var   imagenentextoparte2Perfil = objeto.imgData.substring(mitad, tamanno);//EN LA SEGUNDA PARTE, ALMACENO DE LA MITAD HASTA EL FINAL DEL TEXTO DE LA IMAGEN
var persona = new Object();
                 persona.idconflicto= hallazgoseleccionado;
                         persona.base641= imagenentextoparte1Perfil;
    persona.base642= imagenentextoparte2Perfil;
                      
                        $.ajax({
                            //url: 'http://bodas.sistemcr.com/api/api/TRIVIA',
                            url: 'api/foto',
                            type: 'POST',
                            dataType: 'json',
                            data: persona,
                            success: function (data, textStatus, xhr) {
              $('#fototeca').unblock();
                                verfotos(hallazgoseleccionado);
alert("Image added to the find");
                                    

                            },
                            error: function (xhr, textStatus, errorThrown) {
                                alert(xhr);
                            }
                        });
                        
                        
                        
                        
                        
                        
                       
                 
                    
    
}
         else{
        
         
         }
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                        }

                        reader.readAsDataURL(input.files[0]);
                    }
                }
   
    
     function imagesdesdevector() {
         
          var r = confirm("You want to add the photo to the find?");
if (r == true) {
                    var contador = 0;
var fila =0
                
                    for (var ele in vectordeimegenesenbase64) {
                        
                         var tamanno = vectordeimegenesenbase64[ele].imgData.length;//RECUPERO EL TAMANNO TOTAL DEL TEXTO BASE 64 DE LA IMAGEN SUBIDA
                            var mitad = Math.round(tamanno / 2);//SACO LA MITAD DEL TAMANNO TOTAL, REDONDEANDOLO PARA QUE ME DE UN NUMERO ENTERO

                          var  imagenentextoparte1Perfil = vectordeimegenesenbase64[ele].imgData.substring(0, mitad);//EN LA PRIMERA PARTE DE LA IMAGEN EN TEXTO, EN LA VARIABLE GLOBAL, ALMACENO EL TEXTO HASTA LA MITAD
                         var   imagenentextoparte2Perfil = vectordeimegenesenbase64[ele].imgData.substring(mitad, tamanno);//EN LA SEGUNDA PARTE, ALMACENO DE LA MITAD HASTA EL FINAL DEL TEXTO DE LA IMAGEN
var persona = new Object();
                 persona.idconflicto= hallazgoseleccionado;
                         persona.base641= imagenentextoparte1Perfil;
    persona.base642= imagenentextoparte2Perfil;
                      
                        $.ajax({
                            //url: 'http://bodas.sistemcr.com/api/api/TRIVIA',
                            url: 'api/foto',
                            type: 'POST',
                            dataType: 'json',
                            data: persona,
                            success: function (data, textStatus, xhr) {


                                 if (contador == 8) {
                            fila = fila + 1;
                          
                        }
                        contador = contador + 1;
                      
                                document.getElementById("fila"+ fila + "n").innerHTML += '<td><img id=' + vectordeimegenesenbase64[ele].nombre + ' src=' + vectordeimegenesenbase64[ele].imgData + ' style ="width: 100px; height: 100px; border-radius:10px;"/></td>';

                       vectordeimegenesenbase64=[];           

                            },
                            error: function (xhr, textStatus, errorThrown) {
                                alert(xhr);
                            }
                        });
                        
                        
                        
                        
                        
                        
                       
                 
                    }
    
}
         else{
         vectordeimegenesenbase64=[];
         
         }
                }
    
    
     
    function cargarzonasprotejidas(map)
    {
               
                        
                          var persona = new Object();
           
                persona.autuser="";
            var tabla;
            $.ajax({
                url: 'api/todaslaszonasprotejidas',
                type: 'POST',
                dataType: 'json',
                data: persona,
                success: function (data, textStatus, xhr) {
                    if (data.ID == 0) {
                        alert("Internet error");
                    } else {
                         localStorage.setItem("ZONASENMAPA", JSON.stringify(data));
                        
                        for (var ele in data) {
                              var coordenadasentexto = JSON.parse(localStorage.getItem("ZONASENMAPA"))[ele].vectordepuntos;
                                                       if(JSON.parse(coordenadasentexto).length == 1)
                  {
                       var myLatlng = new google.maps.LatLng(parseFloat(JSON.parse(localStorage.getItem("ZONASENMAPA"))[ele].ejex), parseFloat( JSON.parse(localStorage.getItem("ZONASENMAPA"))[ele].ejey));
                       var circle = new google.maps.Circle({
        fillColor: '#'+(Math.random()*0xFFFFFF<<0).toString(16),
        fillOpacity: 0.6,
        strokeWeight: 0.8,
        strokeColor: '#ff0000',
        draggable: false,
        editable: false,
        map: map,
        center: myLatlng,
        radius: JSON.parse(coordenadasentexto)[0].lng
    });
              
                            
                      
                      
                  }
                else{
                       
                         bermudaTriangle = new google.maps.Polygon({
  paths: JSON.parse(coordenadasentexto),
  strokeColor: '#FF0000',
  strokeOpacity: 0.5,
  strokeWeight: 0.8,
  fillColor: '#'+(Math.random()*0xFFFFFF<<0).toString(16),
  fillOpacity: 0.35
});
                    bermudaTriangle.setMap(map); 
                   
           
                    
                            
                    
                    
                }
                            
                            
                            
                        }}}
                
            });
                        
                        
                        
                        
                    
    }
    
    function cargar()
    {
         $('#cuadrotabla').block({
                            message: '<h4>Charging...</h4><img src="/imgs/carga.gif" style="width:25%;height:25%;"/>',


                        });
                 
                     var persona = new Object();
      persona.autuser=JSON.parse(localStorage.getItem("usuariologueado"))[0].nombre + ' ' + JSON.parse(localStorage.getItem("usuariologueado"))[0].apellido;
            var tabla;
            $.ajax({
              url: 'api/conflictotodos',
                 // url: 'http://192.168.1.135//api/Listado',
                type: 'POST',
                dataType: 'json',
                data: persona,
                success: function (data, textStatus, xhr) {
                  
                              localStorage.setItem("hallazgosadm", JSON.stringify(data));
                        for (var ele in data) {

                            var tableRef = document.getElementById('tabla').getElementsByTagName('tbody')[0];

                            // Insert a row in the table at the last row
                            var newRow = tableRef.insertRow(tableRef.rows.length);

                            // Insert a cell in the row at index 0
                            
                              var newCell = newRow.insertCell(0);

                            // Append a text node to the cell
                            var newText = document.createTextNode(data[ele].Nameofconflict)

                            newCell.appendChild(newText);
                            
                           
                        
                            var newCell2 = newRow.insertCell(1);

//
                            var newText2 = document.createTextNode(data[ele].Country);
                            newCell2.appendChild(newText2);
//
                          
  
                              var newCell4 = newRow.insertCell(2);
   var newText3 = document.createTextNode(data[ele].StateorProvince);
                            newCell4.appendChild(newText3);
  
                                  var newCell4 = newRow.insertCell(3);
   var newText3 = document.createTextNode(data[ele].estadoensistema);
                            newCell4.appendChild(newText3);


                            
                        
                            data[ele].vectordepuntosdezona = "";
                           
                               var btnFORZAR = document.createElement("button");
                               //btnmodifica.type = "button";
                             //btnFORZAR.type="button";
                             btnFORZAR.setAttribute("class", "btn btn-lg btn-info btn-block");
                               btnFORZAR.id = 'btnmod' + data[ele]._id;
                              // btnFORZAR.value="Buscar";
                         btnFORZAR.setAttribute("onclick", "modificaconflicto('"+ data[ele]._id +"')");
                            var newCell10 = newRow.insertCell(4);
                            
                              newCell10.appendChild(btnFORZAR);
                            
                            
                              var btnFORZAR = document.createElement("button");
                               //btnmodifica.type = "button";
                             //btnFORZAR.type="button";
                             btnFORZAR.setAttribute("class", "btn btn-lg btn-info btn-block");
                               btnFORZAR.id = 'btndel' + data[ele]._id;
                              // btnFORZAR.value="Buscar";
                         btnFORZAR.setAttribute("onclick", "eliminaconflicto('"+data[ele]._id +"','"+ data[ele].Nameofconflict +"')");
                            var newCell10 = newRow.insertCell(5);
                            
                              newCell10.appendChild(btnFORZAR);
                            
                             
                              var btnFORZAR = document.createElement("button");
                               //btnmodifica.type = "button";
                             //btnFORZAR.type="button";
                             btnFORZAR.setAttribute("class", "btn btn-lg btn-info btn-block");
                             btnFORZAR.setAttribute("data-target", "#largeModalphoto");
                                 btnFORZAR.setAttribute("data-toggle", "modal");
                  
                               btnFORZAR.id = 'btnverfotos' + data[ele]._id;
                              // btnFORZAR.value="Buscar";
                         btnFORZAR.setAttribute("onclick", "verfotos('"+data[ele]._id +"')");
                            var newCell10 = newRow.insertCell(6);
                            
                              newCell10.appendChild(btnFORZAR);
                            
                            
                            
                                var btnFORZAR = document.createElement("button");
                               //btnmodifica.type = "button";
                             //btnFORZAR.type="button";
                             btnFORZAR.setAttribute("class", "btn btn-lg btn-info btn-block");
                             btnFORZAR.setAttribute("data-target", "#largeModalmapa");
                                 btnFORZAR.setAttribute("data-toggle", "modal");
                  
                               btnFORZAR.id = 'btnverfotos' + data[ele]._id;
                              // btnFORZAR.value="Buscar";
                         btnFORZAR.setAttribute("onclick", "capaenelmapa('"+data[ele]._id +"')");
                            var newCell10 = newRow.insertCell(7);
                            
                              newCell10.appendChild(btnFORZAR);
                            
                            
//                                 }
                        }
                  
                        
                          $('#cuadrotabla').unblock();
                   
                  

                },
                error: function (xhr, textStatus, errorThrown) {
                    alert(xhr);
                }
            });

    }
    function eliminaconflicto(id,nombre)
    {
        var r = confirm("You want to eliminate the find: " + nombre);
if (r == true) {
  var persona = new Object();
                 
                        persona.id = id;
                        persona.autuser=JSON.parse(localStorage.getItem("usuariologueado"))[0].nombre + " "+ JSON.parse(localStorage.getItem("usuariologueado"))[0].apellido;
                        $.ajax({
                            //url: 'http://bodas.sistemcr.com/api/api/TRIVIA',
                            url: 'api/eliminaconflicto',
                            type: 'POST',
                            dataType: 'json',
                            data: persona,
                            success: function (data, textStatus, xhr) {
                              






alert("Find correctly removed");

      $('#cajausuario').unblock();


location.href='Listahallazgos.html';
                            },
                            error: function (xhr, textStatus, errorThrown) {
                                alert(xhr);
                            }
                        });
} else {
    
}
         
    }
    
    function salirdelsistema()
    {
        localStorage.setItem("usuariologueado",null);
      //  localstorage.setItem("usuariologueado",null);
        location.href = "login.html";
    }
      function verfotos(id)
    {
        hallazgoseleccionado=id;
        $('#fototeca').block({
                            message: '<h4>Charging...</h4><img src="/imgs/carga.gif" style="width:25%;height:25%;"/>',


                        });
        
         var persona = new Object();
                 
                        persona.idconflicto =id;
                          persona.autuser=JSON.parse(localStorage.getItem("usuariologueado"))[0].nombre + ' ' + JSON.parse(localStorage.getItem("usuariologueado"))[0].apellido;
                        $.ajax({
                            //url: 'http://bodas.sistemcr.com/api/api/TRIVIA',
                            url: 'api/fotoxconflicto',
                            type: 'POST',
                            dataType: 'json',
                            data: persona,
                            success: function (data, textStatus, xhr) {
                              
    var contador = 0;
var fila =0
 document.getElementById("fila0").innerHTML ="";
               document.getElementById("fila1").innerHTML ="";
               document.getElementById("fila2").innerHTML ="";
               document.getElementById("fila3").innerHTML ="";
                                  document.getElementById("imagengrande").src = "";
                                if(data.length == 0)
                                    {
                                        document.getElementById("fila0").innerHTML ="No images attached";
                                    }
  for (var ele in data) {
                        if (contador == 8) {
                            fila = fila + 1;
                          
                        }
                        contador = contador + 1;
                      
                                document.getElementById("fila"+ fila).innerHTML += '<td><table><tr><td><img id=' + data[ele]._id + ' src=' + data[ele].base64 + ' style ="cursor:pointer;width: 100px; height: 100px; border-radius:10px;" class="paraagrandar" /></td><tr><td><button type="button" class="btn btn-secondary mb-1" data-toggle="modal" id='+ data[ele]._id +' data-target="#largeModalphoto" onclick=\"eliminaimg(this.id)\">Delete</button></td></tr></table></td>';

                 
                    }
                             $(".paraagrandar").click(function(){

                                 document.getElementById("imagengrande").src = this.src;
});   
                                    $('#fototeca').unblock();
                                
                            },
                            error: function (xhr, textStatus, errorThrown) {
                                alert(xhr);
                            }
                        });
    }
    function eliminaimg(id)
    {
        alert(id);
             var r = confirm("You want to delete the photo?");
if (r == true) {
  var persona = new Object();
                 
                        persona.id = id;
                        
                        $.ajax({
                            //url: 'http://bodas.sistemcr.com/api/api/TRIVIA',
                            url: 'api/eliminafotoxid',
                            type: 'POST',
                            dataType: 'json',
                            data: persona,
                            success: function (data, textStatus, xhr) {
                              






alert("Photo deleted correctly");

      $('#cajausuario').unblock();

     $('#' + id).remove();

                            },
                            error: function (xhr, textStatus, errorThrown) {
                                alert(xhr);
                            }
                        });
} else {
    
}
    }
    function modificaconflicto(dato)
    {
        
  
        localStorage.setItem("conflictoamodificar",dato);
        
        location.href= "Hallazgomodifica.html";
    }
    function capaenelmapa(id)
    {
          hallazgoseleccionado=id;
        for (var ele in JSON.parse(localStorage.getItem("hallazgosadm")))
            {
        if(JSON.parse(localStorage.getItem("hallazgosadm"))[ele]._id==id)
            {
         var map = new google.maps.Map(document.getElementById('mapdetalle'), {
          center: {lat: parseFloat(JSON.parse(localStorage.getItem("hallazgosadm"))[ele].ejex), lng: parseFloat( JSON.parse(localStorage.getItem("hallazgosadm"))[ele].ejey)},
          zoom: 10
        });

          var drawingManager = new google.maps.drawing.DrawingManager({
          drawingMode: google.maps.drawing.OverlayType.MARKER,
          drawingControl: true,
          drawingControlOptions: {
            position: google.maps.ControlPosition.TOP_CENTER,
            drawingModes: ['polygon', 'circle']
          },
          markerOptions: {icon: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png'},
          circleOptions: {
            fillColor: '#ffff00',
            fillOpacity: 0.3,
            strokeWeight: 1,
            clickable: false,
            editable: true,
            zIndex: 1
          }
        });
                       
                cargarzonasprotejidas(map);
                       
                       var coordenadasentexto = JSON.parse(localStorage.getItem("hallazgosadm"))[ele].vectordepuntosdezona;
                
                
              if(JSON.parse(coordenadasentexto).length == 1)
                  {
                       var myLatlng = new google.maps.LatLng(parseFloat(JSON.parse(localStorage.getItem("hallazgosadm"))[ele].ejex), parseFloat( JSON.parse(localStorage.getItem("hallazgosadm"))[ele].ejey));
                       var circle = new google.maps.Circle({
        fillColor: '#ffffff',
        fillOpacity: .6,
        strokeWeight: 1,
        strokeColor: '#ff0000',
        draggable: false,
        editable: false,
        map: map,
        center: myLatlng,
        radius: JSON.parse(coordenadasentexto)[0].lng
    });
                      
                  }
                else{
                       console.log(coordenadasentexto)
                       
                        var bermudaTriangle = new google.maps.Polygon({
  paths: JSON.parse(coordenadasentexto),
  strokeColor: '#FF0000',
  strokeOpacity: 0.5,
  strokeWeight: 0.8,
  fillColor: '#FF0000',
  fillOpacity: 0.35
});
                        bermudaTriangle.setMap(map);
            }
               drawingManager.setMap(map); 
                
                      google.maps.event.addListener(drawingManager, 'polygoncomplete', function (polygon) {
                           var r = confirm("You want to replace the find layer on the map?");
if (r == true) {
                    
    var coordinates = (polygon.getPath().getArray());
             
    console.log(coordinates);
               var ejex="";
    var ejey="";
               for (var i = 0; i < polygon.getPath().getLength(); i++) {
                   var res = polygon.getPath().getAt(i).toUrlValue(6).split(",");
       console.log(res[0],res[1]);
                   ejex=res[0];
                   ejey=res[1];
    }
     $('#largeModalmapa').block({
                            message: '<h4>Charging...</h4><img src="/imgs/carga.gif" style="width:25%;height:25%;"/>',


                        });
      var persona = new Object();
                 
                        persona.id = hallazgoseleccionado;
                        persona.ejex=ejex;
    persona.ejey=ejey;
    persona.vectordepuntosdezona=JSON.stringify(coordinates);
                        $.ajax({
                            //url: 'http://bodas.sistemcr.com/api/api/TRIVIA',
                            url: 'api/modificacapa',
                            type: 'POST',
                            dataType: 'json',
                            data: persona,
                            success: function (data, textStatus, xhr) {
                              






alert("Modified correctly");

      $('#largeModalmapa').unblock();



                            },
                            error: function (xhr, textStatus, errorThrown) {
                                alert(xhr);
                            }
                        });
    
}
});
                
                
                
                
                
                    
          google.maps.event.addListener(drawingManager, 'circlecomplete', function (event) {
              
                         var r = confirm("You want to replace the find layer on the map?");
if (r == true) {
      var center = event.getCenter().lat();
        var radius = event.getRadius();

 var poligonio2= '[{"lat":0,"lng":'+radius+'}]';
              ejex=event.getCenter().lat();
                  ejey=event.getCenter().lng();  
    
    
    
      $('#largeModalmapa').block({
                            message: '<h4>Charging...</h4><img src="/imgs/carga.gif" style="width:25%;height:25%;"/>',


                        });
      var persona = new Object();
                 
                        persona.id = hallazgoseleccionado;
                        persona.ejex=ejex;
    persona.ejey=ejey;
    persona.vectordepuntosdezona=poligonio2;
                        $.ajax({
                            //url: 'http://bodas.sistemcr.com/api/api/TRIVIA',
                            url: 'api/modificacapa',
                            type: 'POST',
                            dataType: 'json',
                            data: persona,
                            success: function (data, textStatus, xhr) {
                              






alert("Modified correctly");

      $('#largeModalmapa').unblock();



                            },
                            error: function (xhr, textStatus, errorThrown) {
                                alert(xhr);
                            }
                        });
    
    
    
}
                        
    });
                
                
                
                
                break;
            }
                       
            }
        
    }
    </script>
      <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXvodJ1BTbGIVjYsnBe7cEXVUPgnM5Nus&libraries=drawing&callback=initMap"
         async defer></script>
</body>

</html>
<!-- end document-->
